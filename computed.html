<!DOCTYPE html>
<html>
<head>
	<title>Vue-计算属性和侦听</title>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js"></script>
</head>
<body>
<div id="app">
	<p>正常输出： {{ message }}</p>
	<p>反转输出： {{ reverseMessage }}</p>
	<p>姓名： {{ fullName }}</p>

	<p><input type="" name="" v-model="question"></p>
	<p>{{ answer }}</p>

	<ul>
		<li v-for="number in numberHandle">{{ number }}</li>
	</ul>
</div>

<script type="text/javascript">
	var app = new Vue({
		el: "#app",
		data: {
			message: "Hello World!",
			firstName: "文丰",
			lastName: "章",
			// fullName: "章文丰"
			question: "",
			answer: "你给我问题我才能回答你！",
			numbers: [1,11,212,12,5,54,85,99]
		},
		created: function () {
			this.debouncedGetAnswer = _.debounce(this.getAnswer, 500);
		},
		computed: {
			reverseMessage: function () {
				// return this.message.split("").reverse().join("");
				return new Date().toLocaleString()
			},
			fullName: function () {
				return this.lastName + " " + this.firstName;
			},
			numberHandle: function (numbers) {
				return this.numbers.filter(function (number) {
					return number%2 === 0;
				});
			}
		},
		watch: {
			firstName: function (val) {
				this.fullName = this.lastName + " " + val
			},
			lastName: function (val) {
				this.fullName = val +　" " + this.firstName;
			},
			question: function(newQuestion, oldQuestion) {
				this.answer = '等待输入完成...';
				this.debouncedGetAnswer();
				// _.debounce(this.getAnswer, 500);
				// this.getAnswer;
			}
		},
		methods: {
			getAnswer: function () {
				console.log(123);
				if (this.question.indexOf("?") === -1) {
					this.answer = '问题内容需要包含"?"';
					return;
				}

				this.answer = "思考中...";

				vm = this;
				axios.get('https://yesno.wtf/api')
				.then(function (response) {
					vm.answer = _.capitalize(response.data.answer)
				})
				.catch(function (response) {
					vm.answer = 'Error! Could not reach the API. ' + error
				})
			}
		}
	});
</script>
</body>
</html>